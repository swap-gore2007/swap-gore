{
  "workflow": {
    "unique_name": "definition_workflow_021EQNQZDBVSR0AgJxIsOWz9a4duVcho90C",
    "name": "Philips Hue - Access Token & Referesh Token",
    "title": "Philips Hue - Access Token & Referesh Token",
    "type": "generic.workflow",
    "base_type": "workflow",
    "variables": [
      {
        "schema_id": "datatype.string",
        "properties": {
          "value": "",
          "scope": "input",
          "name": "Philips_Hue_Authorization_Code",
          "type": "datatype.string",
          "description": "Run below command on any web browser to get authorization code:\nhttps://api.meethue.com/v2/oauth2/authorize?client_id=VfyGrlV4my6hxyJ3Shx9D4K9x2ydAbyz&response_type=code&state=Passw0rd@123\n\nNote: This code is valid for very short time. It needs to be generated again if it is expired.",
          "is_required": true,
          "is_invisible": false
        },
        "unique_name": "variable_workflow_021I64IAFYK2T3BC44pzL68jITLFSjnIm3b",
        "object_type": "variable_workflow"
      }
    ],
    "properties": {
      "atomic": {
        "is_atomic": false
      },
      "delete_workflow_instance": false,
      "description": "This workflow generates Access and Refresh token using Authorization code. \nTo get authorization code, follow below steps as mentioned in (https://developers.meethue.com/develop/hue-api/remote-authentication-oauth/)\n1. Register your application i.e. SecureX in Philips Hue developer account (create one if doesn't exist). Get client id and client secret.\n2. Get authorization code by typing below URL in any web browser: https://api.meethue.com/v2/oauth2/authorize?client_id=<client_id>&response_type=code&state=<any_string>\nThis will redirect to the meethue login portal for a user to grant permissions to the resources. Once you allow permission, it will be redirected to URL you mentioned while registering application (SecureX). That redirected link will have authorization \"code\".\nUse authoriztaion code as input to this workflow. \nAlso create global variables \"Philips Hue - Access Token\" & \"Philips Hue - Refresh Token\" and Target \"Philips Hue - OAuth2 Authentication\" https://api.meethue.com/v2/",
      "display_name": "Philips Hue - Access Token & Referesh Token",
      "runtime_user": {
        "target_default": true
      },
      "target": {
        "target_type": "web-service.endpoint",
        "target_id": "definition_target_021EY48VKRW7Y03qXw9AyyxcGbEnxbiamHO",
        "execute_on_workflow_target": true
      }
    },
    "object_type": "definition_workflow",
    "actions": [
      {
        "unique_name": "definition_activity_021ESIJ40LH3Y7D0Lk5RmjVT7m8e7P52rFL",
        "name": "HTTP Request",
        "title": "HTTP Request",
        "type": "web-service.http_request",
        "base_type": "activity",
        "properties": {
          "accept": "*/*",
          "action_timeout": 180,
          "allow_auto_redirect": true,
          "allow_headers_redirect": false,
          "body": "grant_type=authorization_code&code=$workflow.definition_workflow_021EQNQZDBVSR0AgJxIsOWz9a4duVcho90C.input.variable_workflow_021I64IAFYK2T3BC44pzL68jITLFSjnIm3b$",
          "continue_on_error_status_code": false,
          "continue_on_failure": false,
          "custom_headers": [
            {
              "name": "Authorization",
              "value": "Basic base64(clientid:clientsecret)"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            }
          ],
          "display_name": "HTTP Request",
          "method": "POST",
          "relative_url": "oauth2/token",
          "runtime_user": {
            "target_default": true
          },
          "skip_execution": false,
          "target": {
            "use_workflow_target": true
          }
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_021ID4EDRH2YW2h81C1ADIrI5LDUzinE4sm",
        "name": "JSONPath Query",
        "title": "JSONPath Query",
        "type": "corejava.jsonpathquery",
        "base_type": "activity",
        "properties": {
          "action_timeout": 180,
          "continue_on_failure": true,
          "display_name": "JSONPath Query",
          "input_json": "$activity.definition_activity_021ESIJ40LH3Y7D0Lk5RmjVT7m8e7P52rFL.output.response_body$",
          "jsonpath_queries": [
            {
              "jsonpath_query": "$.access_token",
              "jsonpath_query_name": "access-token",
              "jsonpath_query_type": "string",
              "zdate_type_format": "yyyy-MM-dd'T'HH:mm:ssZ"
            },
            {
              "jsonpath_query": "$.refresh_token",
              "jsonpath_query_name": "refresh-token",
              "jsonpath_query_type": "string"
            }
          ],
          "skip_execution": false
        },
        "object_type": "definition_activity"
      },
      {
        "unique_name": "definition_activity_021IHDYQMBWIM6LomcL0r9KhK6mAwprEEPz",
        "name": "Set Variables",
        "title": "Set Variables",
        "type": "core.set_multiple_variables",
        "base_type": "activity",
        "properties": {
          "continue_on_failure": false,
          "display_name": "Set Variables",
          "skip_execution": false,
          "variables_to_update": [
            {
              "variable_to_update": "$global.variable_021IHC6XQPUZ75wwwDYyEAKLxldMQIGFWXb.global.variable_021IHC6XQPUZ75wwwDYyEAKLxldMQIGFWXb$",
              "variable_value_new": "$activity.definition_activity_021ID4EDRH2YW2h81C1ADIrI5LDUzinE4sm.output.jsonpath_queries.access-token$"
            },
            {
              "variable_to_update": "$global.variable_021IHCGCTY5PR3DxVLrz149DdHwLrdJjpru.global.variable_021IHCGCTY5PR3DxVLrz149DdHwLrdJjpru$",
              "variable_value_new": "$activity.definition_activity_021ID4EDRH2YW2h81C1ADIrI5LDUzinE4sm.output.jsonpath_queries.refresh-token$"
            }
          ]
        },
        "object_type": "definition_activity"
      }
    ],
    "categories": [
      "category_1BMfMXSnJMyt5Ihqi7rWJr5N8cf"
    ]
  },
  "targets": {
    "definition_target_021EY48VKRW7Y03qXw9AyyxcGbEnxbiamHO": {
      "unique_name": "definition_target_021EY48VKRW7Y03qXw9AyyxcGbEnxbiamHO",
      "name": "Philips Hue - OAuth2 Authentication",
      "title": "Philips Hue - OAuth2 Authentication",
      "type": "web-service.endpoint",
      "base_type": "target",
      "object_type": "definition_target",
      "properties": {
        "disable_certificate_validation": false,
        "display_name": "Philips Hue - OAuth2 Authentication",
        "host": "api.meethue.com",
        "ignore_proxy": true,
        "no_runtime_user": true,
        "path": "/v2/",
        "protocol": "https"
      }
    }
  },
  "variables": {
    "variable_021IHC6XQPUZ75wwwDYyEAKLxldMQIGFWXb": {
      "unique_name": "variable_021IHC6XQPUZ75wwwDYyEAKLxldMQIGFWXb",
      "properties": {
        "value": "bq1V9wFXFSI7xyGr3J48SNzWDWGy",
        "scope": "global",
        "name": "Philips Hue - Access Token",
        "type": "datatype.string",
        "is_required": false,
        "is_invisible": false
      },
      "object_type": "variable"
    },
    "variable_021IHCGCTY5PR3DxVLrz149DdHwLrdJjpru": {
      "unique_name": "variable_021IHCGCTY5PR3DxVLrz149DdHwLrdJjpru",
      "properties": {
        "value": "1Jm7jULazIdY76NhUGM327XUMYOsUWrh",
        "scope": "global",
        "name": "Philips Hue - Refresh Token",
        "type": "datatype.string",
        "is_required": false,
        "is_invisible": false
      },
      "object_type": "variable"
    }
  }
}
